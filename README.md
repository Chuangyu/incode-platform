isis-wicket-gmap3
=================

An extension for [Apache Isis](http://isis.apache.org)' [Wicket viewer](http://isis.apache.org/components/viewers/wicket/about.html), to render a collection of entities within a map (using google's [gmap3](https://developers.google.com/maps/documentation/javascript/) API).  

### Screenshots

The following screenshots are based on the app generated by Isis' [quickstart archetype](http://isis.apache.org/getting-started/quickstart-archetype.html). Each `ToDoItem` has been made `Locatable`.  See below for further details.

![](https://raw.github.com/danhaywood/isis-wicket-gmap3/master/images/screenshot-1.png)

![](https://raw.github.com/danhaywood/isis-wicket-gmap3/master/images/screenshot-2.png)

![](https://raw.github.com/danhaywood/isis-wicket-gmap3/master/images/screenshot-3.png)


### Dependencies

This component has a dependency in turn on the [wicketstuff-gmap3](https://github.com/wicketstuff/core/wiki/Gmap3) component.  Currently this is only available in SNAPSHOT form, obtained from [Sonatype's OSS repository](https://oss.sonatype.org/content/repositories/snapshots).

### Configuration

In your project's parent `pom.xml`, add to the `<dependencyManagement>` section:

    <dependencyManagement>
        <dependencies>
            ...
            <dependency>
                <groupId>com.danhaywood.isis.wicket.ui.components</groupId>
                <artifactId>danhaywood-isis-wicket-gmap3</artifactId>
                <version>1.0.0-SNAPSHOT</version>
                <type>pom</type>
                <scope>import</scope>
            </dependency>
            ...
        </dependencies>
    </dependencyManagement>

In your project's DOM `pom.xml`, add a dependency on the `applib` module:

    <dependencies>
        ...
        <dependency>
            <groupId>com.danhaywood.isis.wicket.ui.components</groupId>
            <artifactId>danhaywood-isis-wicket-gmap3-applib</artifactId>
        </dependency>
        ...
    </dependencies> 

Although not mandatory, you might also want to use the `LocationLookupService` that's provided, allowing for simple descriptions (eg "10 Downing Street, London") to be converted into `Location`s.  Add this dependency in your project's DOM `pom.xml`:

    <dependencies>
        ...
        <dependency>
            <groupId>com.danhaywood.isis.wicket.ui.components</groupId>
            <artifactId>danhaywood-isis-wicket-gmap3-service</artifactId>
        </dependency>
        ...
    </dependencies> 


Finally, there is a required dependency in your project's webapp `pom.xml` to the `ui` module:

    <dependencies>
        ...
        <dependency>
            <groupId>com.danhaywood.isis.wicket.ui.components</groupId>
            <artifactId>danhaywood-isis-wicket-gmap3-ui</artifactId>
        </dependency>
        ...
    </dependencies> 


### Usage

Make your entity implement `com.danhaywood.isis.wicket.gmap3.applib.Locatable`, so that it provides a `Location` property of type `com.danhaywood.isis.wicket.gmap3.applib.Location`.

If using the JDO objectstore, then this property will need to be annotated as `@Persistent`.  Other objectstores (at least, those that use the facilities of Isis' `ValueSemanticsProvider` API) should require no additional configuration.

For example:

import com.danhaywood.isis.wicket.gmap3.applib.Locatable;
import com.danhaywood.isis.wicket.gmap3.applib.Location;

<pre>
public class ToDoItem implements Locatable {

    ...

    // {{
    @Persistent
    private Location location;
    
    @MemberOrder(name="Detail", sequence = "10")
    @Optional
    public Location getLocation() {
        return location;
    }
    public void setLocation(Location location) {
        this.location = location;
    }
    // }}

}
</pre>

You should then find that any collections of entities that have `Locatable` properties (either returned from an action, or as a parented collection) will be rendered in a map.

### End-user entry of `Location`s

If you have configured the `LocationLookupService` (recommended), then you can write an action to lookup the `Location` using the service injected into some entity.  For example:

<pre>
    public void lookupLocation(@Named("Description") String description) {
        setLocation(locationLookupService.lookup(description));
    }
</pre>

Alternatively, you can allow the `Location` to be specified as a string.  The format is:

     mmm.mmm;nnn.nnn

where:

* `mmm.mmm` is the latitute, and
* `nnn.nnn` is the longitude 

